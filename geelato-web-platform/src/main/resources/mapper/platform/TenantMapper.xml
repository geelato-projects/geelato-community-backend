<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.geelato.web.platform.srv.tenant.mapper.TenantMapper">

    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="cn.geelato.web.platform.srv.tenant.entity.Tenant">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="code" property="code" jdbcType="VARCHAR"/>
        <result column="corp_id" property="corpId" jdbcType="VARCHAR"/>
        <result column="company_name" property="companyName" jdbcType="VARCHAR"/>
        <result column="company_domain" property="companyDomain" jdbcType="VARCHAR"/>
        <result column="main_email_pwd" property="mainEmailPwd" jdbcType="VARCHAR"/>
        <result column="main_email" property="mainEmail" jdbcType="VARCHAR"/>
        <result column="corp_token" property="corpToken" jdbcType="VARCHAR"/>
        <result column="dept_id" property="deptId" jdbcType="VARCHAR"/>
        <result column="bu_id" property="buId" jdbcType="VARCHAR"/>
        <result column="tenant_code" property="tenantCode" jdbcType="VARCHAR"/>
        <result column="del_status" property="delStatus" jdbcType="INTEGER"/>
        <result column="update_at" property="updateAt" jdbcType="TIMESTAMP"/>
        <result column="updater" property="updater" jdbcType="VARCHAR"/>
        <result column="updater_name" property="updaterName" jdbcType="VARCHAR"/>
        <result column="create_at" property="createAt" jdbcType="TIMESTAMP"/>
        <result column="creator" property="creator" jdbcType="VARCHAR"/>
        <result column="creator_name" property="creatorName" jdbcType="VARCHAR"/>
        <result column="delete_at" property="deleteAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id, code, corp_id, company_name, company_domain, main_email_pwd, main_email,
        corp_token, dept_id, bu_id, tenant_code, del_status, update_at, updater,
        updater_name, create_at, creator, creator_name, delete_at
    </sql>

    <!-- 分页查询租户列表 -->
    <select id="selectTenantList" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM platform_tenant
        WHERE del_status = 0
        <if test="code != null and code != ''">
            AND code LIKE CONCAT('%', #{code}, '%')
        </if>
        <if test="companyName != null and companyName != ''">
            AND company_name LIKE CONCAT('%', #{companyName}, '%')
        </if>
        <if test="corpId != null and corpId != ''">
            AND corp_id = #{corpId}
        </if>
        ORDER BY create_at DESC
    </select>

    <!-- 根据租户编码查询 -->
    <select id="selectByCode" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM platform_tenant
        WHERE code = #{code} AND del_status = 0
        LIMIT 1
    </select>

    <!-- 根据企业名称查询 -->
    <select id="selectByCompanyName" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM platform_tenant
        WHERE company_name = #{companyName} AND del_status = 0
        LIMIT 1
    </select>

    <!-- 根据企业ID查询 -->
    <select id="selectByCorpId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM platform_tenant
        WHERE corp_id = #{corpId} AND del_status = 0
        LIMIT 1
    </select>

    <!-- 查询所有有效租户 -->
    <select id="selectAllValidTenants" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM platform_tenant
        WHERE del_status = 0
        ORDER BY create_at DESC
    </select>

</mapper>